import{u as S,E as h,r,j as e,d as f,s as N,L as v,S as k,R as T,b as C}from"./base-Bcv0CVqz.js";import{u as E,T as R}from"./Toast-CsrIgyfG.js";import{C as O}from"./check-BANNbU_a.js";function P(){const[i,s]=r.useState(!1);async function c(){s(!0),await k(),setTimeout(()=>s(!1),3e3)}return e.jsxs("button",{className:"btn btn-sm btn-primary",disabled:i,onClick:c,children:[i?e.jsx("span",{className:"loading loading-spinner loading-sm"}):e.jsx("svg",{"aria-label":"Google logo",width:"16",height:"16",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",children:e.jsxs("g",{children:[e.jsx("path",{d:"m0 0H512V512H0",fill:"#ffffff00"}),e.jsx("path",{fill:"#34a853",d:"M153 292c30 82 118 95 171 60h62v48A192 192 0 0190 341"}),e.jsx("path",{fill:"#4285f4",d:"m386 400a140 175 0 0053-179H260v74h102q-7 37-38 57"}),e.jsx("path",{fill:"#fbbc02",d:"m90 341a208 200 0 010-171l63 49q-12 37 0 73"}),e.jsx("path",{fill:"#ea4335",d:"m153 219c22-69 116-109 179-50l55-54c-78-75-230-72-297 55"})]})}),"Login with Google"]})}const B=window.location.search.includes("checkout");function L(){const{toast:i,showToast:s}=E(),c=S(h),[n,p]=r.useState(""),[l,u]=r.useState(!1),[d,g]=r.useState(""),[m,o]=r.useState(!1),[x,b]=r.useState(!1);async function j(a){if(a.preventDefault(),!!n){o(!0);try{(await(await fetch(`${f}/send-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n})})).json()).success?u(!0):s("Failed to send code. Make sure Email is correct.","alert-error")}catch(t){console.error(t),s("Something went wrong. Please try again later.","alert-error")}o(!1)}}async function w(a){if(a.preventDefault(),!!d){o(!0);try{const t=await(await fetch(`${f}/verify-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,otp:d})})).json();if(t.success){const y=await N("updateSubscription",void 0);b(!0),await h.setValue(n),B&&!y&&setTimeout(()=>{window.open(`${v}?checkout[email]=${n}`,"_blank"),window.close()},2e3)}else t.error?s(t.error,"alert-error"):s("Failed to restore subscription. Make sure Email and Code are correct.","alert-error")}catch(t){console.error(t),s("Something went wrong. Please try again later.","alert-error")}o(!1)}}return c||x?e.jsx("div",{className:"min-h-[100vh] bg-base-200 grid place-items-center",children:e.jsx("div",{className:"card w-96 bg-base-100 text-base-content","data-theme":"dark",children:e.jsxs("div",{className:"card-body items-center text-center",children:[e.jsx(O,{size:64,className:"text-success"}),e.jsx("h1",{className:"card-title mb-4",children:"Logged in!"}),e.jsx("p",{children:"Welcome back! "}),e.jsx("p",{children:"You can close this tab and continue using the extension."})]})})}):e.jsxs("div",{className:"min-h-[100vh] bg-base-200 grid place-items-center",children:[e.jsx(R,{toast:i}),e.jsx("div",{className:"card w-96 bg-base-100 text-base-content","data-theme":"dark",children:e.jsxs("form",{className:"card-body",onSubmit:l?w:j,children:[e.jsx("h2",{className:"card-title justify-between",children:"Login"}),e.jsxs("fieldset",{className:"fieldset",children:[e.jsx("legend",{className:"fieldset-legend",children:"Email"}),e.jsx("input",{type:"email",className:"input w-full",placeholder:"user@example.com",value:n,onChange:a=>p(a.target.value),disabled:l,required:!0}),e.jsx("p",{className:"fieldset-label",children:"Use your checkout email to restore purchase"})]}),l&&e.jsxs("fieldset",{className:"fieldset",children:[e.jsx("legend",{className:"fieldset-legend",children:"Code"}),e.jsx("input",{type:"text",className:"input w-full",placeholder:"123456",pattern:"[0-9]{6}",value:d,onChange:a=>g(a.target.value),required:!0}),e.jsx("p",{className:"fieldset-label",children:"Sent to the email above"})]}),e.jsxs("button",{className:"btn btn-sm btn-primary",type:"submit",disabled:m,children:[m&&e.jsx("span",{className:"loading loading-spinner"}),l?"Restore":"Send OTP"]}),l&&e.jsxs("p",{className:"text-center opacity-70 mt-2",children:["Didn't get the code? ",e.jsx("button",{className:"link",onClick:()=>u(!1),children:"Request Again"})]}),e.jsx("div",{className:"divider",children:"OR"}),e.jsx(P,{})]})})]})}T.createRoot(document.getElementById("root")).render(e.jsx(C.StrictMode,{children:e.jsx(L,{})}));
