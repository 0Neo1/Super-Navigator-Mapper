import{G as p,C as h,D as m,a as g,c as k,j as e,g as v,u as r,A,B as b,i as G,E as R,r as x,L as V,S as P,R as U,b as I}from"./base-Bcv0CVqz.js";import{D as _,B as $,a as z,g as d,b as u}from"./BackupStatus-DcmMqDbF.js";import{u as N,T as B}from"./Toast-CsrIgyfG.js";async function L(){let a={chatgpt:await g.getValue(),deepseek:await m.getValue(),claude:await h.getValue(),gemini:await p.getValue(),lastBackupAt:Date.now()},s=new Blob([JSON.stringify(a)],{type:"application/json"}),t=URL.createObjectURL(s),o=document.createElement("a");o.href=t,o.download=`Pin GPTs Backup ${new Date().toLocaleDateString()}.json`,o.click()}function M(){return new Promise((a,s)=>{let t=document.createElement("input");t.type="file",t.accept=".json",t.click(),t.onchange=async()=>{var n;let o=(n=t.files)==null?void 0:n[0];if(!o){s("No file selected");return}let c=await o.text(),i=JSON.parse(c);await S(i),a()}})}async function S(a){await g.setValue(a.chatgpt),await m.setValue(a.deepseek),await h.setValue(a.claude),a.gemini&&await p.setValue(a.gemini)}/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]],q=k("CloudDownload",O);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],J=k("CloudUpload",H);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],K=k("Upload",Y);function W(){const{toast:a,showToast:s}=N();return e.jsxs(e.Fragment,{children:[e.jsx(B,{toast:a}),e.jsx("h2",{className:"card-title justify-between",children:"Manual File Backup"}),e.jsx("p",{className:" text-gray-400",children:"Export your data to a file on your device and import it later."}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:async()=>{try{await M(),setTimeout(()=>{alert("Backup Restored")},200)}catch{s("Failed to restore backup. ","alert-error")}},children:[e.jsx(K,{size:20})," Upload File"]}),e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:L,children:[e.jsx(_,{size:20})," Download File"]})]})]})}const C="pins_backup.json";async function D(a){var s;try{const t=await fetch("https://www.googleapis.com/drive/v3/files?spaces=appDataFolder&fields=files(id,name)",{headers:{Authorization:`Bearer ${a}`}});if(t.status===401)throw new Error("Unauthorized access. Please check your access token.");if(!t.ok)throw new Error(`Failed to fetch backup file ID: ${t.statusText}`);return((s=((await t.json()).files||[]).find(i=>i.name===C))==null?void 0:s.id)||null}catch(t){throw console.error("Error fetching backup file ID:",t),new Error("Failed to retrieve backup file ID. Please check your access token and try again.")}}async function Q(){try{const a=await v();if(!a)throw new Error("Access token is required to download backup.");let s={chatgpt:await g.getValue(),deepseek:await m.getValue(),claude:await h.getValue(),gemini:await p.getValue(),lastBackupAt:Date.now()};const t=await D(a),o={name:C};t||(o.parents=["appDataFolder"]);const c=new FormData;c.append("metadata",new Blob([JSON.stringify(o)],{type:"application/json"})),c.append("file",new Blob([JSON.stringify(s)],{type:"application/json"}));const i=t?`https://www.googleapis.com/upload/drive/v3/files/${t}?uploadType=multipart`:"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",n=await fetch(i,{method:t?"PATCH":"POST",headers:{Authorization:`Bearer ${a}`},body:c});if(n.status===401)throw new Error("Unauthorized access. Please check your access token.");if(!n.ok)throw new Error(`Failed to upload backup: ${n.statusText}`);return console.log("Backup saved:",await n.json()),s}catch(a){throw console.error("Error saving backup:",a),new Error("Failed to save backup. Please check your access token and try again.")}}async function X(){try{const a=await v();if(!a)throw new Error("Access token is required to download backup.");const s=await D(a);return s?await(await fetch(`https://www.googleapis.com/drive/v3/files/${s}?alt=media`,{headers:{Authorization:`Bearer ${a}`}})).json():null}catch(a){throw console.error("Error downloading backup:",a),new Error("Failed to download backup. Please check your access token and try again.")}}function Z(){const[a,s]=x.useState(!1);async function t(){s(!0),await P(),setTimeout(()=>s(!1),2e3)}return e.jsxs("button",{className:"btn btn-sm",disabled:a,onClick:t,children:[a?e.jsx("span",{className:"loading loading-spinner loading-sm"}):e.jsx("svg",{"aria-label":"Google logo",width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",children:e.jsxs("g",{children:[e.jsx("path",{d:"m0 0H512V512H0",fill:"#ffffff00"}),e.jsx("path",{fill:"#34a853",d:"M153 292c30 82 118 95 171 60h62v48A192 192 0 0190 341"}),e.jsx("path",{fill:"#4285f4",d:"m386 400a140 175 0 0053-179H260v74h102q-7 37-38 57"}),e.jsx("path",{fill:"#fbbc02",d:"m90 341a208 200 0 010-171l63 49q-12 37 0 73"}),e.jsx("path",{fill:"#ea4335",d:"m153 219c22-69 116-109 179-50l55-54c-78-75-230-72-297 55"})]})}),"Login"]})}function ee(){const{toast:a,showToast:s}=N(),t=r(A),o=r(b),c=r(G),i=r(R),[n,j]=x.useState(!1),[w,y]=x.useState(!1),f=t&&c;async function F(){y(!0);try{const l=await Q();console.log("Uploaded backup:",l),b.setValue({...o,lastBackupAt:l.lastBackupAt}),s("Backup saved successfully.","alert-success")}catch{s("Something went wrong. Please try again later.","alert-error")}y(!1)}async function E(){j(!0);try{const l=await X();console.log("Downloaded backup:",l),l?(await S(l),s("Backup Restored!","alert-success")):s("No backup found in Google Drive.","alert-error")}catch{s("Something went wrong. Please try again later.","alert-error")}j(!1)}return e.jsxs(e.Fragment,{children:[e.jsx(B,{toast:a}),e.jsx("h2",{className:"card-title justify-between",children:"Google Drive Backup"}),e.jsx("p",{className:" text-gray-400",children:"Save your data to your Google Drive account. You can restore it later from any device."}),!t&&e.jsxs("div",{role:"alert",className:"alert alert-error alert-soft",children:[e.jsx("span",{children:"You must be logged in with Google to backup data to your Google Drive account."}),e.jsx(Z,{})]}),t&&!c&&e.jsxs("div",{role:"alert",className:"alert alert-error alert-soft",children:[e.jsx("span",{children:"You must be subscribed to backup data to your Google Drive account."}),e.jsxs("a",{className:"btn btn-sm",href:`${V}?checkout[email]=${i}`,children:[e.jsx($,{size:20})," Upgrade"]})]}),e.jsxs("label",{className:"label grid grid-cols-2",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"label-text",children:"Automatic Backup (every 24 hours)"})}),e.jsx("input",{type:"checkbox",disabled:!f,checked:o.enabled,className:"toggle justify-self-end",onChange:async l=>{const T=l.target.checked;b.setValue({...o,enabled:T})}})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsxs("button",{disabled:!f||n||w,className:"btn btn-sm btn-primary",onClick:E,children:[n?e.jsx("span",{className:"loading loading-spinner"}):e.jsx(q,{size:20}),"Restore now"]}),e.jsxs("button",{disabled:!f||w||n,className:"btn btn-sm btn-primary",onClick:F,children:[w?e.jsx("span",{className:"loading loading-spinner"}):e.jsx(J,{size:20}),"Backup now"]})]}),e.jsx(z,{showLink:!1})]})}function ae(){const a=r(g),s=r(h),t=r(p),o=r(m);return e.jsx("div",{className:"min-h-[100vh] bg-base-200 grid place-items-center",children:e.jsx("div",{className:"card w-lg bg-base-100 text-base-content","data-theme":"dark",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title justify-between",children:"Backup"}),e.jsxs("div",{className:"stats stats-horizontal shadow border border-base-300 mb-2 bg-base-200",children:[e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-title text-base-content font-bold",children:"ChatGPT"}),e.jsxs("div",{className:"stat-desc",children:[d(a)," Chats"]}),e.jsxs("div",{className:"stat-desc",children:[u(a)," Folders"]})]}),e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-title text-base-content font-bold",children:"Claude"}),e.jsxs("div",{className:"stat-desc",children:[d(s)," Chats"]}),e.jsxs("div",{className:"stat-desc",children:[u(s)," Folders"]})]}),e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-title text-base-content font-bold",children:"Gemini"}),e.jsxs("div",{className:"stat-desc",children:[d(t)," Chats"]}),e.jsxs("div",{className:"stat-desc",children:[u(t)," Folders"]})]}),e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-title text-base-content font-bold",children:"DeepSeek"}),e.jsxs("div",{className:"stat-desc",children:[d(o)," Chats"]}),e.jsxs("div",{className:"stat-desc",children:[u(o)," Folders"]})]})]}),e.jsx(ee,{}),e.jsx("span",{className:"divider m-0"}),e.jsx(W,{})]})})})}U.createRoot(document.getElementById("root")).render(e.jsx(I.StrictMode,{children:e.jsx(ae,{})}));
